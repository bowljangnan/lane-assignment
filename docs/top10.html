version: v1.0.0
<span style="font-size:20px;margin-left: 10px"><b><a href="index.html">메인으로 이동</a></b></span> <br><br>
<title>볼장난 명예의 전당</title>
<head>
    <link rel="shortcut icon" type="image/x-icon" href="icons/icons.ico">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2KPHH0BQLN"></script>
    <script src="https://unpkg.com/hangul-js" type="text/javascript"></script>
    <script>
      window.dataLayer = window.dataLayer || [];

      function gtag() {
        dataLayer.push(arguments);
      }

      gtag('js', new Date());

      gtag('config', 'G-2KPHH0BQLN');
    </script>
</head>

<span style="font-size:50px;"><b> 👑 볼장난 명예의 전당 👑</b></span><br><br><br>
<div>
</div>
<div>
    <span style="font-size:20px;"><b> - 월간 / 연간 통계 - </b></span><br>
    <div style="margin: 20px">
        <select id='month-select'
                style="width:100px;height:25px;font-size:20px;align-content: center"
                onchange="changeMonthSelect()">
            <option value=12>
                전체
            </option>
            <option value=0>
                1월
            </option>
            <option value=1>
                2월
            </option>
            <option value=2>
                3월
            </option>
            <option value=3>
                4월
            </option>
            <option value=4>
                5월
            </option>
            <option value=5>
                6월
            </option>
            <option value=6>
                7월
            </option>
            <option value=7>
                8월
            </option>
            <option value=8>
                9월
            </option>
            <option value=9>
                10월
            </option>
            <option value=10>
                11월
            </option>
            <option value=11>
                12월
            </option>
        </select>
    </div>
    <div style="font-size:15px;margin-left: 20px;margin-bottom: 5px;"><b> 볼장난 게임 수: <span
            id="total-game-count-div" style="color: red"></span> 게임 </b></div>
    <div style="font-size:15px;margin-left: 20px;margin-bottom: 5px;"><b> 볼장난 참여 회원 수: <span
            id="total-participant-count-div" style="color: red"></span> 명 </b></div>
    <div style="float:left;margin: 20px;width: 400px">
        <span style="font-size:15px;"><b> 게임 수 </b></span><br>
        <table style="width: 100%; text-align: center">
            <thead>
            <td><b>순위</b></td>
            <td><b>이름</b></td>
            <td><b>횟수</b></td>
            </thead>
            <tr id="game-count-top1" style="width: 20px; font-size: 15px;font-weight: bold">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="game-count-top2" style="width: 20px; font-size: 15px;font-weight: bold">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="game-count-top3" style="width: 20px; font-size: 15px;font-weight: bold">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="game-count-top4" style="width: 20px; font-size: 15px;">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="game-count-top5" style="width: 20px; font-size: 15px;">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="game-count-top6" style="width: 20px; font-size: 15px;">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="game-count-top7" style="width: 20px; font-size: 15px;">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="game-count-top8" style="width: 20px; font-size: 15px;">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="game-count-top9" style="width: 20px; font-size: 15px;">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="game-count-top10" style="width: 20px; font-size: 15px;">
                <td></td>
                <td></td>
                <td></td>
            </tr>
        </table>
    </div>

    <div style="float:left;margin: 20px;width: 400px">
        <span style="font-size:15px;"><b> 모임 참여 횟수 </b></span><br>
        <table style="width: 100%; text-align: center">
            <thead>
            <td><b>순위</b></td>
            <td><b>이름</b></td>
            <td><b>횟수</b></td>
            </thead>
            <tr id="participation-top1" style="width: 20px; font-size: 15px;font-weight: bold">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="participation-top2" style="width: 20px; font-size: 15px;font-weight: bold">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="participation-top3" style="width: 20px; font-size: 15px;font-weight: bold">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="participation-top4" style="width: 20px; font-size: 15px;">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="participation-top5" style="width: 20px; font-size: 15px;">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="participation-top6" style="width: 20px; font-size: 15px;">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="participation-top7" style="width: 20px; font-size: 15px;">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="participation-top8" style="width: 20px; font-size: 15px;">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="participation-top9" style="width: 20px; font-size: 15px;">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="participation-top10" style="width: 20px; font-size: 15px;">
                <td></td>
                <td></td>
                <td></td>
            </tr>
        </table>
    </div>
</div>
<br>
<div style="clear:both">
    <div style="float:left;margin: 20px;width: 400px">
        <span style="font-size:15px;"><b> 에버리지 <span style="color:red">(10게임 이상)</span> </b></span><br>
        <table style="width: 100%; text-align: center">
            <thead>
            <td><b>순위</b></td>
            <td><b>이름(게임 수)</b></td>
            <td><b>점수</b></td>
            </thead>
            <tr id="average-top1" style="width: 20px; font-size: 15px;font-weight: bold">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="average-top2" style="width: 20px; font-size: 15px;font-weight: bold">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="average-top3" style="width: 20px; font-size: 15px;font-weight: bold">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="average-top4" style="width: 20px; font-size: 15px">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="average-top5" style="width: 20px; font-size: 15px">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="average-top6" style="width: 20px; font-size: 15px">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="average-top7" style="width: 20px; font-size: 15px">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="average-top8" style="width: 20px; font-size: 15px">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="average-top9" style="width: 20px; font-size: 15px">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="average-top10" style="width: 20px; font-size: 15px">
                <td></td>
                <td></td>
                <td></td>
            </tr>
        </table>
    </div>

    <div style="float:left;margin: 20px;width: 400px">
        <span style="font-size:15px;"><b> 에버리지(여자) <span style="color:red">(10게임 이상)</span> </b></span><br>
        <table style="width: 100%; text-align: center">
            <thead>
            <td><b>순위</b></td>
            <td><b>이름(게임 수)</b></td>
            <td><b>점수</b></td>
            </thead>
            <tr id="womans-average-top1" style="width: 20px; font-size: 15px;font-weight: bold">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="womans-average-top2" style="width: 20px; font-size: 15px;font-weight: bold">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="womans-average-top3" style="width: 20px; font-size: 15px;font-weight: bold">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="womans-average-top4" style="width: 20px; font-size: 15px">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="womans-average-top5" style="width: 20px; font-size: 15px">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="womans-average-top6" style="width: 20px; font-size: 15px">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="womans-average-top7" style="width: 20px; font-size: 15px">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="womans-average-top8" style="width: 20px; font-size: 15px">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="womans-average-top9" style="width: 20px; font-size: 15px">
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr id="womans-average-top10" style="width: 20px; font-size: 15px">
                <td></td>
                <td></td>
                <td></td>
            </tr>
        </table>
    </div>
    <!--    <div style = "float:left;margin: 20px">-->
    <!--        <span style="font-size:15px;"><b> 200점 이상 횟수 </b></span><br>-->
    <!--        <table>-->
    <!--            <tr>-->
    <!--                <td>순위</td>-->
    <!--                <td>이름</td>-->
    <!--                <td>횟수</td>-->
    <!--            </tr>-->
    <!--            <tr id = "over200-top1"><td></td><td></td><td></td></tr>-->
    <!--            <tr id = "over200-top2"><td></td><td></td><td></td></tr>-->
    <!--            <tr id = "over200-top3"><td></td><td></td><td></td></tr>-->
    <!--            <tr id = "over200-top4"><td></td><td></td><td></td></tr>-->
    <!--            <tr id = "over200-top5"><td></td><td></td><td></td></tr>-->
    <!--            <tr id = "over200-top6"><td></td><td></td><td></td></tr>-->
    <!--            <tr id = "over200-top7"><td></td><td></td><td></td></tr>-->
    <!--            <tr id = "over200-top8"><td></td><td></td><td></td></tr>-->
    <!--            <tr id = "over200-top9"><td></td><td></td><td></td></tr>-->
    <!--            <tr id = "over200-top10"><td></td><td></td><td></td></tr>-->
    <!--        </table>-->
    <!--    </div>-->
</div>
<div style="clear:both"></div>
<div><br><br>
    <span style="font-size:20px;"><b> - 전체 통계 - </b></span><br><br>

    <div style="float:left;margin: 20px;width: 400px">
        <span style="font-size:20px"><b> 🎳 퍼펙트(300) 클럽 </b></span><br>
        <table id="perfect-table" style="width: 100%">
            <thead>
            <td><b>이름</b></td>
            <td><b>날짜</b></td>
            </thead>
        </table>
    </div>
</div>

<script>
  window.onload = initialize()

  const memberList = []
  const womansList = []

  function initialize() {
    const spreadSheetUrl = 'https://sheets.googleapis.com/v4/spreadsheets/1Vh6MyPi5RFYFgmqBa7L6t3Krra2-wXaULc_5XEWoAAY/values/total?key=AIzaSyC7Sh_mpcpjyEcnowiGHiwfM8PZbwWHtAY'

    const month = new Date().getMonth()
    document.getElementById("month-select")[month + 1].selected = true

    fetch(spreadSheetUrl, null)
      .then((response) => response.json())
      .then((data) => initializeMemberList(data["values"]))
      .then(() => initializeRankView(month))
      .then(() => initializePerfect())
      .catch((error) => console.log("error:", error))
  }

  function initializeMemberList(values) {
    for (let index = 0; index < values.length; index++) {
      let sex = values[index][0]
      let name = values[index][1]

      const user = {}
      user.name = name

      const monthlyData = []
      for (let valueIndex = 2; valueIndex < values[index].length; valueIndex += 4) {
        const data = {}
        data.participationCount = values[index][valueIndex]
        data.gameCount = values[index][valueIndex + 1]
        data.average = values[index][valueIndex + 2]

        monthlyData.push(data)
      }

      monthlyData[monthlyData.length - 1].average = totalAverage(monthlyData)

      user.monthlyData = monthlyData
      memberList.push(user)

      if (sex === '여') {
        womansList.push(user)
      }

    }

    console.log(memberList)
  }

  function changeMonthSelect() {
    const month = document.getElementById("month-select").value
    initializeRankView(month)
  }

  function initializeRankView(month) {
    initializeTable();
    initializeTotalGameCount(month);
    initializeParticipantCount(month);
    initializeGameCountRank(month)
    initializeParticipationCountRank(month)
    initializeAverageRank(month)
    initializeWomansAverageRank(month)
  }

  function initializeGameCountRank(monthlyIndex) {
    const top10 = memberList.filter(member =>
      member.monthlyData !== null
      && member.monthlyData[monthlyIndex].gameCount !== ''
      && member.monthlyData[monthlyIndex].gameCount != 0)
      .sort((member1, member2) => member2.monthlyData[monthlyIndex].gameCount
        - member1.monthlyData[monthlyIndex].gameCount)
      .slice(0, 10)

    let index = 1
    for (const member of top10) {
      const row = document.getElementById("game-count-top" + index);
      row.innerHTML = ''
      row.innerHTML += '<td>' + getRankString(index) + '</td>'
      row.innerHTML += '<td>' + getNameTag(member.name) + '</td>'
      row.innerHTML += '<td>' + member.monthlyData[monthlyIndex].gameCount + '</td>'

      index += 1
    }
  }

  function initializeParticipationCountRank(monthlyIndex) {
    const top10 = memberList.filter(member =>
      member.monthlyData !== null
      && member.monthlyData[monthlyIndex].participationCount !== ''
      && member.monthlyData[monthlyIndex].participationCount != 0)
      .sort((member1, member2) => member2.monthlyData[monthlyIndex].participationCount
        - member1.monthlyData[monthlyIndex].participationCount)
      .slice(0, 10)

    let index = 1
    for (const member of top10) {
      const row = document.getElementById("participation-top" + index);
      row.innerHTML = ''
      row.innerHTML += '<td>' + getRankString(index) + '</td>'
      row.innerHTML += '<td>' + getNameTag(member.name) + '</td>'
      row.innerHTML += '<td>' + member.monthlyData[monthlyIndex].participationCount + '</td>'

      index += 1
    }
  }

  function initializeAverageRank(monthlyIndex) {

    const top10 = memberList.filter(member =>
      member.monthlyData !== null
      && member.monthlyData[monthlyIndex].participationCount !== ''
      && member.monthlyData[monthlyIndex].participationCount != 0
      && member.monthlyData[monthlyIndex].gameCount >= 10)
      .sort((member1, member2) => member2.monthlyData[monthlyIndex].average
        - member1.monthlyData[monthlyIndex].average)
      .slice(0, 10)

    let index = 1
    for (const member of top10) {
      const row = document.getElementById("average-top" + index);
      row.innerHTML = ''
      row.innerHTML += '<td>' + getRankString(index) + '</td>'
      row.innerHTML += '<td>' + getNameTag(member.name)  + '(' + member.monthlyData[monthlyIndex].gameCount + ')</td>'
      row.innerHTML += '<td>' + member.monthlyData[monthlyIndex].average + '</td>'

      index += 1
    }
  }

  function initializeWomansAverageRank(monthlyIndex) {

    const top10 = womansList.filter(member =>
      member.monthlyData !== null
      && member.monthlyData[monthlyIndex].participationCount !== ''
      && member.monthlyData[monthlyIndex].participationCount != 0
      && member.monthlyData[monthlyIndex].gameCount >= 10)
      .sort((member1, member2) => member2.monthlyData[monthlyIndex].average
        - member1.monthlyData[monthlyIndex].average)
      .slice(0, 10)

    let index = 1
    for (const member of top10) {
      const row = document.getElementById("womans-average-top" + index);
      row.innerHTML = ''
      row.innerHTML += '<td>' + getRankString(index) + '</td>'
      row.innerHTML += '<td>' + getNameTag(member.name)  + '(' + member.monthlyData[monthlyIndex].gameCount + ')</td>'
      row.innerHTML += '<td>' + member.monthlyData[monthlyIndex].average + '</td>'

      index += 1
    }
  }

  function initializePerfect() {
    const spreadSheetUrl = 'https://sheets.googleapis.com/v4/spreadsheets/1Vh6MyPi5RFYFgmqBa7L6t3Krra2-wXaULc_5XEWoAAY/values/perfect?key=AIzaSyC7Sh_mpcpjyEcnowiGHiwfM8PZbwWHtAY'

    fetch(spreadSheetUrl, null)
      .then((response) => response.json())
      .then((data) => initializePerfectView(data["values"]))
      .catch((error) => console.log("error:", error))
  }

  function initializePerfectView(values) {
    const table = document.getElementById("perfect-table");

    for (const value of values) {
      table.innerHTML += '<tr style="width: 20px; font-size: 15px"><td><b>' + getNameTag(value[0]) + '</b></td><td><b>' + value[1] + '</b></td></tr>'
    }
  }

  function initializeTotalGameCount(monthlyIndex) {
    const filteredList = memberList.filter(member =>
      member.monthlyData !== null
      && member.monthlyData[monthlyIndex].gameCount !== ''
      && member.monthlyData[monthlyIndex].gameCount != 0)

    let totalCount = 0;
    if (filteredList.length !== 0) {
      totalCount = filteredList.map(member => member.monthlyData[monthlyIndex].gameCount)
        .reduceRight((a, b) => parseInt(a) + parseInt(b))
    }

    document.getElementById("total-game-count-div").innerHTML = totalCount.toLocaleString();
  }

  function initializeParticipantCount(monthlyIndex) {
    const filteredList = memberList.filter(member =>
      member.monthlyData !== null
      && member.monthlyData[monthlyIndex].participationCount !== ''
      && member.monthlyData[monthlyIndex].participationCount != 0)

    document.getElementById("total-participant-count-div").innerHTML = filteredList.length;
  }

  function getRankString(rank) {
    switch (rank) {
      case 1:
        return '🥇'
      case 2:
        return '🥈'
      case 3:
        return '🥉'
      default:
        return rank + '위'
    }
  }

  function initializeTable() {
    for (let i = 1; i <= 10; i++) {
      document.getElementById("game-count-top" + i).innerHTML = '<td></td><td></td><td></td>';
      document.getElementById("participation-top" + i).innerHTML = '<td></td><td></td><td></td>';
      document.getElementById("average-top" + i).innerHTML = '<td></td><td></td><td></td>';
    }
  }

  function getNameTag(name) {
    return '<a href="personal-statistics.html?name=' + name + '">' + name + '</a>'
  }

  function totalAverage(monthlyData) {
    let totalCount = 0;
    let totalScore = 0;
    for (let i = 0; i < monthlyData.length - 1; i++) {
      if (monthlyData[i].gameCount == 0) {
        continue
      }
      totalScore += monthlyData[i].average * monthlyData[i].gameCount
      totalCount += monthlyData[i].gameCount
    }

    return (totalScore / totalCount).toFixed(1)
  }

</script>

<footer class="footer">
    Copyright © 2022 NY.KING. All rights reserved.
</footer>

<style>
    button {
        width: 110px;
        height: 30px;
        font-size: 12px;
    }

    footer {
        align-content: center;
        position: fixed;
        left: 0px;
        bottom: 0px;
        height: 60px;
        width: 100%;
        background: grey;
        color: white;
    }

    table, th, td {
        padding: 10px;
        border: 1px solid black;
        border-collapse: collapse;
    }
</style>
<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>