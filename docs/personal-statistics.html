<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
version: v1.0.0
<span style="font-size:20px;margin-left: 10px"><b><a href="index.html">메인으로 이동</a></b></span> <br>
<br>
<title>볼장난 주간 기록 통계 조회</title>
<head>
    <link rel="shortcut icon" type="image/x-icon" href="icons/icons.ico">
     Global site tag (gtag.js) - Google Analytics
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2KPHH0BQLN"></script>
    <script>
      window.dataLayer = window.dataLayer || [];

      function gtag() {
        dataLayer.push(arguments);
      }

      gtag('js', new Date());

      gtag('config', 'G-2KPHH0BQLN');
    </script>

    <!-- Google Tag Manager -->
<!--    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':-->
<!--        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],-->
<!--      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=-->
<!--      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);-->
<!--    })(window,document,'script','dataLayer','GTM-T2B8S7R');</script>-->
    <!-- End Google Tag Manager -->
</head>

<span style="font-size:30px;"><b> - 볼장난 전체 인원 - </b></span><br>
<span style="font-size:15px;color:red"><b>* 버튼을 누르면 주간 개인 기록을 조회할 수 있습니다.</b></span><br>
<span style="font-size:15px;color:red"><b>* 올해 게임 기록이 없다면 버튼이 비활성화 됩니다.</b></span><br><br>
<div style="font-size:20px;margin-bottom: 20px">
    검색: <input id="search-input" style="width:200px;height:30px" onchange="initializeMemberView()"
               placeholder="이름을 검색하세요"/>
</div>
<div id="member-div">

</div>

<br><br>
<span style="font-size:30px;"><b> - 개인 주간 기록 조회: <b><span id="name-span"
                                                          style="font-size:30px; color:blue;"></span></b> - </b></span>
<br><br>
<div id="profile-area-div" style="width:800px;text-align: center; display: none;">
    <div id="profile-div" style="background-image: url(profiles/default.png);
        background-repeat : no-repeat;
        background-size: cover;
        background-position: center;

    width: 250px; height: 250px; margin: 0 auto; border: 1px solid black"
    >
    </div>
    <br>
    <span id="profile-guide-div" style="font-size:12px;color:red;"><b>멋있는 프로필 사진으로 변경하고 싶으신가요? 지금 노유👑에게 문의하세요!</b></span>
</div>
<br>
<div id="statistics-div">
    <table id="weekly-statistics-table" style="width:800px">
        <thead>
            <td><b>2022년 주간</b></td>
            <td><b>게임 수</b></td>
            <td><b>평균</b></td>
            <td><b>최고 점수</b></td>
            <td><b>최저 점수</b></td>
            <td><b>게임비</b></td>
        </thead>
    </table>
    <br><br>
    <div id='chart-div' style="width:800px;font-size:20px;color:red">
    </div>
</div>

<script>
  window.onload = initialize()

  let weeklySheets = []
  const memberList = []
  let memberViewList = []
  const memberStatistics = new Map()

  let scoreDistributionChart
  let participationChart
  let averageChart
  let allMemberScoreDistributionChart

  let currentSelectedButton

  const userButtonPrefix = 'user_button_'

  function initialize() {
    initializeMember();
  }

  function initializeMember() {

    const spreadSheetUrl = 'https://sheets.googleapis.com/v4/spreadsheets/1Vh6MyPi5RFYFgmqBa7L6t3Krra2-wXaULc_5XEWoAAY/values/average?key=AIzaSyC7Sh_mpcpjyEcnowiGHiwfM8PZbwWHtAY'

    fetch(spreadSheetUrl, null)
      .then((response) => response.json())
      .then((data) => initializeMemberMap(data["values"]))
      .then(() => {
        initializeMemberStatistics().then(() => {
          setTimeout(() => {
            const urlParams = new URLSearchParams(window.location.search);
            const name = convertName(urlParams.get('name'));
            if (name != null && memberStatistics.get(name) !== undefined) {
              showStatistics(name)
            }
          }, 1000)
        })
      })
      .catch((error) => console.log("error:", error))

    return new Promise(function (resolve) {
      resolve()
    });
  }

  function initializeMemberMap(values) {
    for (let index = 0; index < values.length; index++) {
      let name = values[index][0]
      memberList.push({"name": convertName(name)})
    }
    memberViewList = memberList.filter(() => true)

    initializeMemberView()

    return new Promise(function (resolve) {
      resolve()
    });
  }

  function initializeMemberView() {

    const searchInput = document.getElementById("search-input");

    const keyword = searchInput.value.trim()
    console.log(keyword)
    if (keyword === '') {
      memberViewList = memberList.filter(() => true)
    } else {
      memberViewList = memberList.filter((member) => member.name.includes(keyword))
    }

    const memberDiv = document.getElementById("member-div");
    memberDiv.innerHTML = ''

    let index = 0
    for (const member of memberViewList) {
      memberDiv.innerHTML += getMemberButtonString(member)
      if ((index + 1) % 8 === 0) {
        memberDiv.innerHTML += '<br><br>'
      }
      index++
    }
    disableUnrecordUserButton()

    return new Promise(function (resolve) {
      resolve()
    });
  }

  function initializeMemberStatistics() {

    const spreadSheetMetaUrl = 'https://sheets.googleapis.com/v4/spreadsheets/1RDT4sZx74q2RUPNOhjg3QF2ynJneUMbg6leHteeHTMw?key=AIzaSyC7Sh_mpcpjyEcnowiGHiwfM8PZbwWHtAY'
    fetch(spreadSheetMetaUrl, null)
      .then((response) => response.json())
      .then((data) => initializeWeeklyRecords(data["sheets"]))

    return new Promise(function (resolve) {
      resolve()
    });
  }

  function disableUnrecordUserButton() {
    for (const memberName of memberViewList) {
      const userMap = memberStatistics.get(memberName.name)
      if (userMap !== undefined && userMap.size !== 0) {
        document.getElementById(userButtonPrefix + memberName.name).disabled = false;
      }
    }

    return new Promise(function (resolve) {
      resolve()
    });
  }

  function initializeWeeklyRecords(weeklySheetDatas) {
    const urlParams = new URLSearchParams(window.location.search);
    const name = convertName(urlParams.get('name'));

    let count = 0;

    for (const weeklySheet of weeklySheetDatas) {

      const sheetName = weeklySheet['properties']['title']

      const spreadSheetUrl = 'https://sheets.googleapis.com/v4/spreadsheets/1RDT4sZx74q2RUPNOhjg3QF2ynJneUMbg6leHteeHTMw/values/' + sheetName + '?key=AIzaSyC7Sh_mpcpjyEcnowiGHiwfM8PZbwWHtAY'

      count++;
      fetch(spreadSheetUrl, null)
        .then((response) => response.json())
        .then((data) => initializeMemberStatisticsMap(sheetName, data["values"]))
        .catch((error) => console.log("error:", error));
    }

    return new Promise(function (resolve) {
      resolve()
    });
  }

  function initializeMemberStatisticsMap(weeklyKey, values) {
    if (values === undefined || values.length === 0) {
      return
    }

    weeklySheets.push(weeklyKey)
    weeklySheets.sort()

    for (let index = 0; index < values.length; index++) {
      let name = convertName(values[index][0])

      if (!memberStatistics.has(name)) {
        memberStatistics.set(name, new Map())
      }

      const userMap = memberStatistics.get(name)

      for (let valueIndex = 1; valueIndex < values[index].length; valueIndex++) {

        if (!userMap.get(weeklyKey)) {
          userMap.set(weeklyKey, [])
        }

        const weeklyRecords = userMap.get(weeklyKey)
        const score = parseInt(values[index][valueIndex])
        if (isNaN(score)) {
          continue;
        }
        weeklyRecords.push(parseInt(values[index][valueIndex]))
      }
    }
    disableUnrecordUserButton()

    return new Promise(function (resolve) {
      resolve()
    });
  }

  function getMemberButtonString(member) {
    return '<span style="padding: 5px;"><button id = ' + userButtonPrefix  + member.name + ' name= ' + member.name + ' onclick="showStatistics(this.name)" disabled>' + getMemberNameString(member) + '</button></span>'
  }

  function getMemberNameString(member) {
    return member.name;
  }

  function showStatistics(name) {
    gtag('event', '유저 조회 이벤트', { 'event_category' : name, 'event_label' : name})

    if (currentSelectedButton !== undefined) {
      currentSelectedButton.disabled = false
    }
    currentSelectedButton = document.getElementById(userButtonPrefix + name);
    currentSelectedButton.disabled = true

    const nameSpan = document.getElementById("name-span");
    nameSpan.innerHTML = name

    const profileDiv = document.getElementById("profile-div");
    const profileAreaDiv = document.getElementById("profile-area-div");

    profileDiv.style.backgroundImage = 'url(profiles/' + name + '.png), url(profiles/default.png)'
    profileAreaDiv.style.display = 'block';

    const statisticsTable = document.getElementById("weekly-statistics-table");
    const totalRow = statisticsTable.getElementsByTagName("tr").length

    for (let index = 1; index < totalRow; index++) {
      statisticsTable.deleteRow(1)
    }

    let teamIndex = 1
    const weeklyMap = memberStatistics.get(name)

    if (weeklyMap === undefined) {
      alert("올해 기록된 주간 기록이 없습니다.")
      return
    }

    for (const weeklyKey of weeklySheets) {
      const newRow = statisticsTable.insertRow(teamIndex)
      newRow.insertCell(0).innerHTML = weeklyKey

      const scores = weeklyMap.get(weeklyKey)

      if (scores === undefined) {
        newRow.insertCell(1).innerHTML = 0
        newRow.insertCell(2).innerHTML = 0
        newRow.insertCell(3).innerHTML = 0
        newRow.insertCell(4).innerHTML = 0
        newRow.insertCell(5).innerHTML =  "0원"
        teamIndex++
        continue
      }

      let statistics = getWeeklyStatistics(scores)
      newRow.insertCell(1).innerHTML = statistics.gameCount
      newRow.insertCell(2).innerHTML = statistics.average.toFixed(2)
      newRow.insertCell(3).innerHTML = statistics.max
      newRow.insertCell(4).innerHTML = statistics.min
      newRow.insertCell(5).innerHTML = (statistics.gameCount * 4100).toLocaleString() + "원"

      teamIndex++
    }

    const newRow = statisticsTable.insertRow(teamIndex)

    let totalStatistics = getYearlyStatistics(weeklyMap)

    newRow.insertCell(0).innerHTML = "<span style='color:red'><b>전체 통계</b></span>"
    newRow.insertCell(1).innerHTML = "<span style='color:red'><b>" + totalStatistics.count + "</b></span>"
    newRow.insertCell(2).innerHTML = "<span style='color:red'><b>" + totalStatistics.average.toFixed(2) + "</b></span>"
    newRow.insertCell(3).innerHTML = "<span style='color:red'><b>" + totalStatistics.max + "</b></span>"
    newRow.insertCell(4).innerHTML = "<span style='color:red'><b>" + totalStatistics.min + "</b></span>"
    newRow.insertCell(5).innerHTML = "<span style='color:red'><b>" + (totalStatistics.count * 4100).toLocaleString() + "원</b></span>"

    drawChart(name)
  }

  function getWeeklyStatistics(scores) {
    let maxScore = 0
    let minScore = 300
    let total = 0
    for (const score of scores) {
      total += score

      if (maxScore < score) {
        maxScore = score
      }

      if (minScore > score) {
        minScore = score
      }
    }

    return {
      "average": total / scores.length,
      "max": maxScore,
      "min": minScore,
      "gameCount": scores.length
    }
  }

  function getYearlyStatistics(weeklyMap) {
    let maxScore = 0
    let minScore = 300
    let total = 0
    let count = 0

    for (const weeklyKey of weeklyMap.keys()) {
      const scores = weeklyMap.get(weeklyKey)

      for (const score of scores) {
        total += score

        if (maxScore < score) {
          maxScore = score
        }

        if (minScore > score) {
          minScore = score
        }
        count++
      }
    }

    return {"average": total / count, "count": count, "max": maxScore, "min": minScore}
  }

  function drawChart(name) {

    if (scoreDistributionChart !== undefined && scoreDistributionChart != null) {
      scoreDistributionChart.destroy();
    }

    if (participationChart !== undefined && participationChart != null) {
      participationChart.destroy();
    }

    if (averageChart !== undefined && averageChart != null) {
      averageChart.destroy();
    }

    if (averageChart !== undefined && averageChart != null) {
      allMemberScoreDistributionChart.destroy();
    }

    const chartDiv = document.getElementById("chart-div");

    chartDiv.innerHTML = ''
    chartDiv.innerHTML += '<canvas id="score-distribution-chart"></canvas><br><br>'
    chartDiv.innerHTML += '<canvas id="participation-chart"></canvas><br><br>'
    chartDiv.innerHTML += '<canvas id="average-chart"></canvas><br>'
    chartDiv.innerHTML += '<canvas id="all-member-score-distribution-chart"></canvas><br>'

    drawScoreDistributionChart(name)
    drawParticipationChart(name)
    drawAverageChart(name)
    drawAllMemberScoreDistributionChart(name)
  }

  function drawScoreDistributionChart(name) {
    // 우선 컨텍스트를 가져옵니다.
    let ctx = document.getElementById("score-distribution-chart").getContext('2d');

    scoreDistributionChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: [
          "0", "10", "20", "30", "40", "50", "60", "70", "80", "90",
          "100", "110", "120", "130", "140", "150", "160", "170", "180", "190",
          "200", "210", "220", "230", "240", "250", "260", "270", "280", "290",
        ],
        datasets: [{
          label: name + ' 점수 분포',
          data: getScoreDistributionData(name),
          backgroundColor: [
            'rgba(75, 152, 192, 0.2)',
            'rgba(75, 162, 192, 0.2)',
            'rgba(75, 172, 192, 0.2)',
            'rgba(75, 182, 192, 0.2)',
            'rgba(75, 192, 192, 0.2)',
            'rgba(75, 202, 192, 0.2)',
            'rgba(75, 212, 192, 0.2)',
            'rgba(75, 222, 192, 0.2)',
            'rgba(75, 232, 192, 0.2)',
            'rgba(75, 242, 192, 0.2)',
            'rgba(54, 162, 155, 0.2)',
            'rgba(54, 162, 165, 0.2)',
            'rgba(54, 162, 175, 0.2)',
            'rgba(54, 162, 185, 0.2)',
            'rgba(54, 162, 195, 0.2)',
            'rgba(54, 162, 205, 0.2)',
            'rgba(54, 162, 215, 0.2)',
            'rgba(54, 162, 225, 0.2)',
            'rgba(54, 162, 235, 0.2)',
            'rgba(54, 162, 245, 0.2)',
            'rgba(155, 99, 132, 0.2)',
            'rgba(165, 99, 132, 0.2)',
            'rgba(175, 99, 132, 0.2)',
            'rgba(185, 99, 132, 0.2)',
            'rgba(195, 99, 132, 0.2)',
            'rgba(205, 99, 132, 0.2)',
            'rgba(215, 99, 132, 0.2)',
            'rgba(225, 99, 132, 0.2)',
            'rgba(235, 99, 132, 0.2)',
            'rgba(245, 99, 132, 0.2)',
          ],
          borderColor: [
            'rgba(75, 192, 192, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(255,99,132,1)',
            'rgba(255,99,132,1)',
            'rgba(255,99,132,1)',
            'rgba(255,99,132,1)',
            'rgba(255,99,132,1)',
            'rgba(255,99,132,1)',
            'rgba(255,99,132,1)',
            'rgba(255,99,132,1)',
            'rgba(255,99,132,1)',
            'rgba(255,99,132,1)',
          ],
          borderWidth: 1
        },
        ]
      },
      options: {
        title: {
          display: true,
          text: name + ' 점수 분포도'
        },
        maintainAspectRatio: true, // default value. false일 경우 포함된 div의 크기에 맞춰서 그려짐.
        scales: {
          yAxes: [{
            ticks: {
              beginAtZero: true,
              stepSize: 1,
              min: 0
            }
          }]
        }
      }
    })
  }

  function drawParticipationChart(name) {
    let ctx = document.getElementById("participation-chart").getContext('2d');

    const colors = getParticipationBarChartColor();

    const labelCount = weeklySheets.length

    participationChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: weeklySheets,
        datasets: [
          {
            label: '볼장난 전체 평균 게임 수',
            data: getEntireMemberParticipationResult().entireCount,
            backgroundColor: createArrayObject(colors.totalBackground, labelCount),
            borderColor: createArrayObject(colors.totalBorder, labelCount),
            borderWidth: 1
          }, {
            label: name + ' 게임 수',
            data: getWeeklyParticipationCountArray(name),
            backgroundColor: createArrayObject(colors.targetBackground, labelCount),
            borderColor: createArrayObject(colors.targetBorder, labelCount),
            borderWidth: 1
          }, {
            label: '볼장난 주간 게임 수 1위',
            data: getEntireMemberParticipationResult().maxCount,
            backgroundColor: createArrayObject(colors.topBackground, labelCount),
            borderColor: createArrayObject(colors.topBorder, labelCount),
            borderWidth: 1
          },
        ]
      },
      options: {
        title: {
          display: true,
          text: name + ' 게임 수 분포 그래프'
        },
        maintainAspectRatio: true, // default value. false일 경우 포함된 div의 크기에 맞춰서 그려짐.
        scales: {
          yAxes: [{
            ticks: {
              beginAtZero: true,
              stepSize: 5,
              min: 0
            }
          }]
        }
      }
    })
  }

  function drawAverageChart(name) {
    let ctx = document.getElementById("average-chart").getContext('2d');

    const colors = getParticipationBarChartColor();

    average = new Chart(ctx, {
      type: 'line',
      data: {
        labels: weeklySheets,
        datasets: [
          {
            label: '볼장난 전체 에버리지',
            data: getEntireMemberAverageResult().entireAverage,
            backgroundColor: colors.totalBackground,
            borderColor: colors.totalBorder,
            fill: false,
            lineTension: 0
          }, {
            label: name + ' 에버리지',
            data: getWeeklyAverage(name),
            backgroundColor: colors.targetBackground,
            borderColor: colors.targetBorder,
            fill: false,
            lineTension: 0
          }, {
            label: '볼장난 주간 에버리지 1위',
            data: getEntireMemberAverageResult().maxAverage,
            backgroundColor: colors.topBackground,
            borderColor: colors.topBorder,
            fill: false,
            lineTension: 0
          },
        ]
      },
      options: {
        title: {
          display: true,
          text: name + ' 에버리지 변화 그래프'
        },
        maintainAspectRatio: true, // default value. false일 경우 포함된 div의 크기에 맞춰서 그려짐.
        hover: {
          mode: 'nearest',
          intersect: true
        },
        scales: {
          xAxes: [{
            display: true
          }],
          yAxes: [{
            display: true,
            ticks: {
              suggestedMin: 150,
            }
          }]
        }
      }
    })
  }

  function drawAllMemberScoreDistributionChart(name) {
    // 우선 컨텍스트를 가져옵니다.
    let ctx = document.getElementById("all-member-score-distribution-chart").getContext('2d');
    const targetAverage = getTotalAverageScore(name)
    allMemberScoreDistributionChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: [
          "0", "10", "20", "30", "40", "50", "60", "70", "80", "90",
          "100", "110", "120", "130", "140", "150", "160", "170", "180", "190",
          "200", "210", "220", "230", "240", "250", "260", "270", "280", "290",
        ],
        datasets: [{
          label: name + ' 에버리지 포함 구간(' + targetAverage  + ')',
          data: getAllMemberAverageDistributionData(),
          backgroundColor: getAllMemberAverageChartBackgroundColor(targetAverage),
          borderColor: getAllMemberAverageChartBorderColor(targetAverage),
          borderWidth: 1
        },
        ]
      },
      options: {
        title: {
          display: true,
          text: '볼장난 전체 멤버 에버리지 분포도'
        },
        maintainAspectRatio: true, // default value. false일 경우 포함된 div의 크기에 맞춰서 그려짐.
        scales: {
          yAxes: [{
            ticks: {
              beginAtZero: true,
              stepSize: 1,
              min: 0
            }
          }]
        }
      }
    })
  }

  function getScoreDistributionData(name) {
    const weeklyMap = memberStatistics.get(name)

    let totalArray = [
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    ]

    for (const weeklyKey of weeklyMap.keys()) {
      const scores = weeklyMap.get(weeklyKey)
      for (const score of scores) {
        totalArray[parseInt(score / 10)] += 1
      }
    }

    return totalArray;
  }

  function getAllMemberAverageDistributionData() {
    let totalArray = [
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    ]

    for (const memberName of memberStatistics.keys()) {
      let count = 0
      let total = 0
      const member = memberStatistics.get(memberName)
      for (const weeklyKey of member.keys()) {
        total += member.get(weeklyKey).reduce((prev, current) => prev + current)
        count += member.get(weeklyKey).length
      }

      totalArray[parseInt((total / count) / 10)] += 1
    }

    return totalArray
  }

  function getParticipationBarChartColor() {

    const participationBarChartColor = {};
    participationBarChartColor.targetBackground = 'rgba(54, 162, 235, 0.2)'
    participationBarChartColor.targetBorder = 'rgba(54, 162, 235, 1)'
    participationBarChartColor.totalBackground = 'rgba(75, 242, 192, 0.2)'
    participationBarChartColor.totalBorder = 'rgba(75, 192, 192, 1)'
    participationBarChartColor.topBackground = 'rgba(245, 99, 132, 0.2)'
    participationBarChartColor.topBorder = 'rgba(255,99,132,1)'

    return participationBarChartColor
  }

  function getAllMemberAverageChartBackgroundColor(targetAverage) {
    let array = [ 'rgba(245, 99, 132, 0.2)' ]

    for (let i=1; i<30; i++) {
      if (parseInt(targetAverage / 10) === i) {
        array.push('rgba(245, 99, 132, 0.2)')
        continue;
      }
      array.push('rgba(54, 162, 235, 0.2)')
    }
    return array
  }

  function getAllMemberAverageChartBorderColor(targetAverage) {
    let array = [ 'rgba(255,99,132,1)' ]
    for (let i=1; i<30; i++) {
      if (parseInt(targetAverage / 10) === i) {
        array.push('rgba(255,99,132,1)',)
        continue;
      }
      array.push('rgba(54, 162, 235, 1)')
    }
    return array
  }

  function createArrayObject(obj, count) {
    const array = [];
    for (let i = 0; i < count; i++) {
      array.push(obj);
    }

    return array;
  }

  function getWeeklyParticipationCountArray(name) {

    const array = [];

    for (const weeklySheet of weeklySheets) {
      const scores = memberStatistics.get(name).get(weeklySheet);
      if (scores === undefined) {
        continue;
      }
      array.push(scores.length)
    }
    return array;
  }

  function getEntireMemberParticipationResult() {

    const entireArray = []
    const maxArray = []

    const result = {}

    for (const weeklySheet of weeklySheets) {
      let totalCount = 0
      let maxCount = 0
      let totalMemberCount = 0
      for (const name of memberStatistics.keys()) {
        const scores = memberStatistics.get(name).get(weeklySheet)
        if (scores === undefined) {
          continue
        }
        const count = scores.length
        totalCount += count
        if (count !== 0) {
          totalMemberCount++
        }

        if (maxCount < count) {
          maxCount = count
        }
      }
      entireArray.push(parseInt(totalCount / totalMemberCount))
      maxArray.push(maxCount)
    }

    result.entireCount = entireArray
    result.maxCount = maxArray

    return result;
  }

  function getWeeklyAverage(name) {

    const array = [];

    let prevAverage = 0
    for (const weeklySheet of weeklySheets) {
      const scores = memberStatistics.get(name).get(weeklySheet)
      if (scores === undefined) {
        continue
      }
      prevAverage = getWeeklyStatistics(scores).average.toFixed(2)
    }

    for (const weeklySheet of weeklySheets) {
      const scores = memberStatistics.get(name).get(weeklySheet)
      if (scores === undefined) {
        array.push(prevAverage)
      } else {
        const currentAverage = getWeeklyStatistics(scores).average.toFixed(2)
        array.push(currentAverage)
        prevAverage = currentAverage
      }
    }


    return array;
  }

  function getTotalAverageScore(name) {

    let total = 0;
    let count = 0;

    for (const weeklySheet of weeklySheets) {
      const scores = memberStatistics.get(name).get(weeklySheet)
      if (scores === undefined) {
        continue
      }
      total += scores.reduce((prev, current) => prev + current)
      count += scores.length
    }
    return (total / count).toFixed(2);
  }

  function getEntireMemberAverageResult() {

    const entireArray = []
    const maxArray = []

    const result = {}

    for (const weeklySheet of weeklySheets) {
      let total = 0
      let memberCount = 0
      let maxAverage = 0
      for (const name of memberStatistics.keys()) {
        const scores = memberStatistics.get(name).get(weeklySheet)
        if (scores === undefined) {
          continue
        }

        const average = getWeeklyStatistics(scores).average
        if (average !== 0) {
          total += average
          memberCount++
        }

        if (maxAverage < average) {
          maxAverage = average
        }
      }

      if (memberCount !== 0 && total !== 0) {
        entireArray.push((total / memberCount).toFixed(2))
      }

      if (maxAverage !== 0) {
        maxArray.push(maxAverage.toFixed(2))
      }
    }

    result.entireAverage = entireArray
    result.maxAverage = maxArray

    return result;
  }

  function convertName(name) {
    return name === '노유한' ? '노유👑' : name
  }

</script>

<footer class="footer">
    Copyright © 2022 NY.KING. All rights reserved.
</footer>

<style>
    button {
        width: 80px;
        height: 30px;
        font-size: 12px;
    }

    footer {
        align-content: center;
        position: fixed;
        left: 0px;
        bottom: 0px;
        height: 60px;
        width: 100%;
        background: grey;
        color: white;
    }

    table, th, td {
        padding: 10px;
        border: 1px solid black;
        border-collapse: collapse;
    }
</style>
<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>